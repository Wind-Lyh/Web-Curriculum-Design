# 各包详细类方法功能说明

## 一、controller包 - Servlet控制器

### UserServlet.java
**作用**：处理所有用户相关请求
**方法**：

- **init：** Servlet初始化方法，初始化各种工具类和组件。
- **doPost：** 主请求处理方法，根据action参数分发到不同的业务逻辑。
- **doGet：** GET请求处理方法，直接转发到doPost方法处理。
- **generateCaptcha：** 生成普通图形验证码。
- **validateFirstStep：** 验证用户名、密码和普通验证码。
- **logout：** 处理用户登出请求。
- **checkLoginStatus：** 检查用户登录状态。
- **getRoleHomePage：** 根据角色ID返回对应首页路径。
- **sendResponse：** 发送标准JSON成功响应。
- **sendError：** 发送标准JSON错误响应。
- **generateRotateCaptcha：** 生成旋转验证码。
- **validateRotateCaptcha：** 验证旋转角度是否正确。
- **generateSlideCaptcha：** 生成滑动验证码。
- **validateSlideCaptcha：** 验证滑动位置是否正确。

### PostServlet.java
**作用**：处理所有帖子相关请求
**方法**：
- **doGet**：显示帖子列表、详情、发布页面等
- **doPost**：处理帖子创建、编辑、删除等操作
- **showPostDetail**：显示帖子详情页面
- **showCreatePostPage**：显示发布帖子页面
- **showEditPostPage**：显示编辑帖子页面
- **showPostList**：显示帖子列表（分页）
- **searchPosts**：搜索帖子
- **handleCreatePost**：处理发布帖子请求
- **handleEditPost**：处理编辑帖子请求
- **handleDeletePost**：处理删除帖子请求

### CommentServlet.java
**作用**：处理所有评论相关请求
**方法**：
- **doGet**：显示评论列表
- **doPost**：处理评论发布、编辑、删除操作
- **showComments**：显示帖子评论列表
- **handleAddComment**：处理添加评论请求
- **handleReplyComment**：处理回复评论请求
- **handleEditComment**：处理编辑评论请求
- **handleDeleteComment**：处理删除评论请求

### LikeServlet.java
**作用**：处理点赞相关请求
**方法**：
- **doPost**：处理点赞/取消点赞请求
- **handleLikePost**：处理点赞帖子请求
- **handleUnlikePost**：处理取消点赞帖子请求
- **handleLikeComment**：处理点赞评论请求
- **handleUnlikeComment**：处理取消点赞评论请求

### FavoriteServlet.java
**作用**：处理收藏相关请求
**方法**：
- **doGet**：显示用户收藏列表
- **doPost**：处理收藏/取消收藏操作
- **showFavorites**：显示用户收藏的帖子列表
- **handleAddFavorite**：处理收藏帖子请求
- **handleRemoveFavorite**：处理取消收藏请求

### PointsServlet.java
**作用**：处理积分相关请求
**方法**：
- **doGet**：显示积分详情、排行榜、兑换页面
- **doPost**：处理积分兑换请求
- **showPoints**：显示用户积分详情
- **showRanking**：显示积分排行榜
- **showExchange**：显示积分兑换页面
- **handleExchange**：处理虚拟道具兑换请求

### FileServlet.java
**作用**：处理文件上传下载请求
**方法**：
- **doGet**：提供文件下载功能
- **doPost**：处理文件上传请求
- **handleUpload**：处理文件上传
- **handleDownload**：处理文件下载
- **handleDeleteFile**：处理文件删除
- **handleAvatarUpload**：专门处理头像上传

### AdminServlet.java
**作用**：处理管理员后台所有请求
**方法**：
- **doGet**：显示管理员页面（用户管理、内容管理、日志查看等）
- **doPost**：处理管理员操作请求
- **showDashboard**：显示管理员仪表板
- **showUserManage**：显示用户管理页面
- **showPostManage**：显示帖子管理页面
- **showCommentManage**：显示评论管理页面
- **handleBanUser**：处理封禁用户请求
- **handleUnbanUser**：处理解封用户请求
- **handleDeletePost**：处理删除帖子请求（管理员权限）
- **handleDeleteComment**：处理删除评论请求（管理员权限）

### HomeServlet.java
**作用**：处理首页和全局搜索请求
**方法**：
- **doGet**：显示首页内容
- **showHomePage**：显示首页（最新帖子、热门帖子、推荐内容）
- **handleSearch**：处理全站搜索请求

### SectionServlet.java
**作用**：处理版块相关请求
**方法**：
- **doGet**：显示版块列表和版块详情
- **showSections**：显示所有版块列表
- **showSectionDetail**：显示特定版块的帖子和信息

### NotificationServlet.java
**作用**：处理通知相关请求
**方法**：
- **doGet**：显示用户通知列表
- **doPost**：处理通知标记已读等操作
- **showNotifications**：显示用户所有通知
- **showUnreadNotifications**：显示未读通知
- **handleMarkAsRead**：处理标记通知为已读请求

### LogoutServlet.java
**作用**：处理用户退出登录
**方法**：
- **doGet**：销毁Session，重定向到首页
- **doPost**：处理退出登录请求

## 二、service包 - 业务逻辑层

### UserService.java（接口）
**作用**：用户业务接口定义
**方法**：
- **register：** 用户注册。
- **login：** 用户登录。
- **updateProfile：** 更新用户资料。
- **changePassword：** 修改密码。
- **uploadAvatar：** 上传头像。
- **bindEmail：** 绑定邮箱。
- **bindPhone：** 绑定手机。
- **getUserById：** 根据ID获取用户信息。
- **getUserByUsername：** 根据用户名获取用户信息。
- **getUserByEmail：** 根据邮箱获取用户信息。
- **checkUsernameExists：** 检查用户名是否存在。
- **checkEmailExists：** 检查邮箱是否存在。
- **checkPhoneExists：** 检查手机是否存在。
- **recordLogin：** 记录用户登录日志。
- **getAllUsers：** 获取所有用户（分页）。
- **banUser：** 封禁用户。
- **unbanUser：** 解封用户。
- **getUserCount：** 获取用户总数。

### PostService.java（接口）
**作用**：帖子业务接口定义
**方法**：
- **createPost**：创建新帖子
- **updatePost**：更新帖子内容
- **deletePost**：删除帖子
- **getPostById**：根据ID获取帖子
- **getPostsBySection**：获取版块下的帖子
- **getPostsByUser**：获取用户发布的帖子
- **searchPosts**：搜索帖子
- **increaseViewCount**：增加帖子浏览数

### CommentService.java（接口）
**作用**：评论业务接口定义
**方法**：
- **addComment**：添加评论
- **updateComment**：更新评论
- **deleteComment**：删除评论
- **getCommentsByPost**：获取帖子的评论
- **getCommentsByUser**：获取用户的评论

### LikeService.java（接口）
**作用**：点赞业务接口定义
**方法**：
- **likePost**：点赞帖子
- **unlikePost**：取消点赞帖子
- **likeComment**：点赞评论
- **unlikeComment**：取消点赞评论
- **isLiked**：检查用户是否已点赞

### PointsService.java（接口）
**作用**：积分业务接口定义
**方法**：
- **addPoints**：增加用户积分
- **deductPoints**：扣除用户积分
- **getUserPoints**：获取用户积分
- **getUserLevel**：获取用户等级
- **exchangeGoods**：兑换虚拟道具
- **getRanking**：获取积分排行榜

## 三、dao包 - 数据访问层

### AdminDao

**作用**：管理员数据访问接口
**方法**：

- **addAdminLog：** 添加管理员操作日志。
- **getAdminLogById：** 根据ID获取管理员日志。
- **getAdminLogs：** 获取管理员操作日志列表（带分页和条件查询）。
- **getAdminLogCount：** 获取管理员操作日志数量（用于分页）。
- **getRecentAdminLogs：** 获取最近N条管理员操作日志。
- **getAdminLogsWithAdminName：** 根据管理员ID获取日志（带管理员姓名）。
- **deleteAdminLog：** 删除指定ID的管理员日志。
- **batchDeleteAdminLogs：** 批量删除管理员日志。
- **clearAllAdminLogs：** 清空所有管理员日志（谨慎使用）。
- **countLogsByActionType：** 根据操作类型统计日志数量。
- **searchAdminLogs：** 搜索管理员日志（支持模糊搜索）。
- **getLogCountByTimeRange：** 获取指定时间段内的日志统计。

### BrowseHistoryDao

**作用**：浏览历史数据访问接口
**方法**：

- **addBrowseHistory：** 添加浏览记录。
- **getBrowseHistoryById：** 根据ID获取浏览记录。
- **clearUserBrowseHistory：** 清空用户浏览历史。
- **deleteBrowseHistory：** 删除浏览记录。
- **getUserBrowseHistoryList：** 获取用户的浏览记录列表。
- **getUserRecentBrowseHistory：** 获取用户最近浏览的帖子。
- **countUserBrowseHistory：** 统计用户的浏览记录数量。
- **checkUserViewedPost：** 检查用户是否浏览过某帖子。
- **getPostBrowseHistoryList：** 获取帖子的浏览记录列表。
- **countPostBrowseTimes：** 统计帖子的浏览次数。
- **getHotBrowsePosts：** 获取热门浏览帖子。
- **getPostBrowseRanking：** 获取帖子热度排名。
- **deleteExpiredBrowseHistory：** 删除过期浏览记录。
- **getUserBrowseFrequency：** 获取用户的浏览频率统计。
- **batchAddBrowseHistory：** 批量添加浏览记录。
- **getUserBrowsedPostIds：** 获取用户的浏览帖子ID列表（去重）。
- **getTotalBrowseCount：** 获取系统总浏览记录数。

- **extractExchangeFromResultSet：** 从ResultSet中提取Exchange对象（私有方法）。

### ExchangeDao

**作用**：兑换数据访问接口
**方法**：

- **insertExchange：** 新增兑换记录。
- **getExchangesByUserId：** 用户兑换历史查询。
- **getAllExchanges：** 兑换明细报表。
- **executeExchange：** 执行兑换流程。
- **getUserExchangeCount：** 统计用户兑换次数。
- **getUserTotalCost：** 统计用户总花费积分。
- **getExchangesByPage：** 分页查询兑换记录。
- **getTotalCount：** 获取总记录数（用于分页）。

### FavoriteDao

**作用**：收藏数据访问接口
**方法**：

- **insert：** 插入收藏记录。
- **delete：** 删除收藏记录。
- **deleteByUserAndPost：** 删除用户的收藏记录。
- **findByUserAndPost：** 检查用户是否已收藏。
- **findByUserId：** 查询用户的收藏（分页）。
- **countByUser：** 统计用户收藏数。

### LikeDao

**作用**：点赞数据访问接口
**方法**：

- **insert：** 插入点赞记录。
- **delete：** 删除点赞记录。
- **findByUserAndTarget：** 根据用户和目标查询点赞记录。
- **deleteByUserAndTarget：** 删除用户的点赞记录。
- **countByTarget：** 统计目标的点赞数。
- **countByUser：** 统计用户的点赞数。

### LoginLogDao

**作用**：日志数据访问接口
**方法**：

- **insert：** 插入登录日志记录。
- **findById：** 根据ID查询登录日志。
- **findByUserId：** 根据用户ID查询登录日志列表。
- **findByUserIdWithPagination：** 根据用户ID分页查询登录日志。
- **findByTimeRange：** 根据时间范围查询登录日志。
- **findByIpAddress：** 根据IP地址查询登录日志。
- **countByUserId：** 统计用户的登录日志数量。
- **findLatestByUserId：** 查询用户最新的登录日志。
- **delete：** 根据ID删除登录日志。
- **deleteByUserId：** 根据用户ID删除登录日志。
- **deleteBeforeTime：** 删除指定时间之前的登录日志。
- **mapResultSetToLoginLog：** 将ResultSet映射为LoginLog对象（私有方法）。

### NotificationDao接口

**作用**：通知数据访问接口
**方法**：

- **insertNotification：** 创建个人通知。
- **getNotificationsByUserId：** 获取用户所有通知。
- **getNotificationsByType：** 按类型查询通知。
- **getUnreadNotifications：** 查询未读通知。
- **markAsRead：** 标记为已读。
- **markAllAsRead：** 批量标记已读（用户所有通知）。
- **markTypeAsRead：** 按类型批量标记已读。
- **countUnreadNotifications：** 未读数统计。
- **countUnreadByType：** 按类型统计未读数。
- **getNotificationsByPage：** 分页查询用户通知。
- **countUserNotifications：** 获取用户通知总数。
- **getUnreadNotificationsByPage：** 获取用户未读通知分页。

### **PointsDao**

**作用**：积分数据访问接口
**方法**：

- **insertPointsRecord：** 新增积分记录 - 插入单条积分变动记录。
- **batchInsertPointsRecords：** 批量新增积分记录。
- **processPointsTransaction：** 带事务的积分操作。
- **getPointsRecordsByUserId：** 按用户ID查询积分记录。
- **getPointsRecordsByType：** 按变更类型查询积分记录。
- **getPointsRecordsByTimeRange：** 按时间范围查询积分记录。
- **getPointsRecordsByPage：** 分页查询积分记录。
- **getPointsRecordsWithUserInfo：** 联合查询带用户信息的积分记录。
- **getPointsRecordsByConditions：** 多条件组合查询积分记录。
- **calculateUserTotalPoints：** 计算用户当前总积分（累加change_amount）。
- **calculatePointsIncomeAndExpense：** 统计用户积分收入与支出。
- **calculatePointsByType：** 按类型统计积分变动。
- **calculatePointsByTimePeriod：** 时间维度统计积分变动（按日/月/年）。
- **getPointsRanking：** 积分排行榜（用户积分排名）。
- **countPointsRecordsByUserId：** 获取用户积分记录总数。
- **countAllPointsRecords：** 获取所有积分记录总数（管理员用）。

### UserDao（接口）

**作用**：用户数据访问接口
**方法**：

- **insert：** 插入用户。
- **findById：** 根据ID查询用户。
- **findByUsername：** 根据用户名查询用户。
- **findByEmail：** 根据邮箱查询用户。
- **update：** 更新用户信息。
- **updateStatus：** 更新用户状态。
- **updatePassword：** 更新用户密码。
- **updatePoints：** 更新用户积分。
- **updateLevel：** 更新用户等级。
- **updateLastLoginTime：** 更新用户最后登录时间。
- **findAll：** 查询所有用户（分页）。
- **search：** 搜索用户。
- **count：** 统计用户总数。
- **countByCondition：** 统计符合条件的用户数。
- **delete：** 删除用户（逻辑删除）。

### UserDaoImpl

**作用**：用户数据访问实现
**方法**：
- **insert：** 向数据库插入新用户记录。
- **findById：** 根据用户ID查询用户信息。
- **findByUsername：** 根据用户名查询用户信息。
- **findByEmail：** 根据邮箱查询用户信息。
- **update：** 更新用户信息。
- **updateStatus：** 更新用户状态。
- **updatePassword：** 更新用户密码。
- **updatePoints：** 更新用户积分。
- **updateLevel：** 更新用户等级。
- **updateLastLoginTime：** 更新用户最后登录时间为当前时间。
- **findAll：** 分页查询所有用户（按创建时间倒序）。
- **search：** 根据关键词搜索用户（用户名、昵称、邮箱）。
- **count：** 统计正常状态用户总数。
- **countByCondition：** 根据条件统计用户数量。
- **delete：** 逻辑删除用户（将状态设为2）。
- **resultSetToUser：** 将ResultSet转换为User对象（私有方法）。

### **VirtualGoodDao**

**作用**：虚拟道具数据访问接口
**方法**：

- **insertVirtualGood：** 新增虚拟道具。
- **updateVirtualGood：** 更新道具信息。
- **deleteVirtualGood：** 删除道具。
- **batchInsertVirtualGoods：** 批量添加道具。
- **batchUpdateVirtualGoods：** 批量更新道具。
- **batchDeleteVirtualGoods：** 批量删除道具。
- **getVirtualGoodById：** 按ID查询道具。
- **getVirtualGoodsByName：** 按名称查询道具（支持模糊查询）。
- **getAllVirtualGoods：** 查询所有道具。
- **getVirtualGoodsOrderByPrice：** 按价格排序查询。
- **setGoodAvailable：** 上架道具。
- **setGoodUnavailable：** 下架道具。
- **batchSetGoodsAvailable：** 批量上架道具。
- **batchSetGoodsUnavailable：** 批量下架道具。
- **getGoodStock：** 查询道具库存。
- **increaseGoodStock：** 增加道具库存。
- **decreaseGoodStock：** 减少道具库存。
- **setGoodStock：** 设置道具库存。
- **updateGoodPrice：** 修改道具价格。
- **countAllVirtualGoods：** 道具总数统计。
- **countAvailableVirtualGoods：** 可用道具统计。
- **calculateTotalStock：** 库存统计（排除无限库存）。
- **getPriceStatistics：** 价格统计。
- **getVirtualGoodsByPage：** 分页查询道具。
- **getVirtualGoodsByConditions：** 条件查询（价格范围、库存、状态）。

### PostDao.java（接口）
**作用**：帖子数据访问接口
**方法**：
- **insert：** 插入帖子。
- **findById：** 根据ID查询帖子。
- **update：** 更新帖子。
- **delete：** 删除帖子（逻辑删除）。
- **findBySectionId：** 根据版块ID查询帖子（分页）。
- **findByUserId：** 根据用户ID查询帖子（分页）。
- **findHotPosts：** 查询热门帖子。
- **findLatestPosts：** 查询最新帖子。
- **search：** 搜索帖子。
- **increaseViewCount：** 增加浏览数。
- **increaseLikeCount：** 增加点赞数。
- **decreaseLikeCount：** 减少点赞数。
- **increaseCommentCount：** 增加评论数。
- **decreaseCommentCount：** 减少评论数。
- **count：** 统计帖子总数。
- **countBySection：** 统计版块帖子数。
- **countByUser：** 统计用户帖子数。

### PostDaoImpl.java
**作用**：帖子数据访问实现
**方法**：
- **insert：** 向数据库插入新帖子记录。
- **findById：** 根据帖子ID查询帖子及关联信息。
- **update：** 更新帖子信息。
- **delete：** 逻辑删除帖子（将状态设为3）。
- **findBySectionId：** 根据版块ID分页查询帖子。
- **findByUserId：** 根据用户ID分页查询帖子。
- **findHotPosts：** 按浏览量降序查询热门帖子。
- **findLatestPosts：** 按创建时间降序查询最新帖子。
- **search：** 根据关键词搜索帖子。
- **increaseViewCount：** 增加帖子浏览量。
- **increaseLikeCount：** 增加帖子点赞数。
- **decreaseLikeCount：** 减少帖子点赞数。
- **increaseCommentCount：** 增加帖子评论数。
- **decreaseCommentCount：** 减少帖子评论数。
- **count：** 统计正常状态帖子总数。
- **countBySection：** 统计版块下的帖子数量。
- **countByUser：** 统计用户发布的帖子数量。
- **resultSetToPost：** 将ResultSet转换为Post对象（私有方法）。

### CommentDao（接口）

**作用**：评论数据访问接口
**方法**：
- **insert：** 插入评论。
- **findById：** 根据ID查询评论。
- **update：** 更新评论。
- **delete：** 删除评论（逻辑删除）。
- **findByPostId：** 根据帖子ID查询评论。
- **findByUserId：** 根据用户ID查询评论（分页）。
- **findByParentId：** 查询父评论下的所有回复。
- **countByPost：** 统计帖子评论数。
- **countByUser：** 统计用户评论数。

### CommentDaoImpl.java

**作用**：评论数据访问实现
**方法**：
- **insert：** 向数据库插入新评论记录。
- **findById：** 根据评论ID查询评论及用户信息。
- **update：** 更新评论内容、点赞数和状态。
- **delete：** 逻辑删除评论（将状态设为1）。
- **findByPostId：** 根据帖子ID查询所有评论。
- **findByUserId：** 根据用户ID分页查询评论。
- **findByParentId：** 根据父评论ID查询回复评论。
- **countByPost：** 统计帖子下的评论数量。
- **countByUser：** 统计用户发布的评论数量。
- **resultSetToComment：** 将ResultSet转换为Comment对象（私有方法）。

## 四、model包 - 实体类

### AdminLog

**作用**：管理员实体类
**属性/方法**：

### User.java
**作用**：用户实体类
**属性/方法**：

```
   private Integer id;            // 用户ID，对应users.id，主键自增
    private String username;       // 用户名，对应users.username，唯一登录标识
    private String password;       // 密码，对应users.password，加密存储
    private String email;          // 邮箱，对应users.email，唯一联系方式
    private String phone;          // 手机号，对应users.phone
    private String avatarUrl;      // 头像地址，对应users.avatar_url，默认default_avatar.png
    private String nickname;       // 昵称，对应users.nickname，用户显示名称
    private String signature;      // 个性签名，对应users.signature
    private Integer points;        // 积分，对应users.points，默认0
    private Integer level;         // 等级，对应users.level，默认1
    private Integer status;        // 状态：0正常，1封禁，对应users.is_banned字段
    private Date createTime;       // 创建时间，对应users.create_time，默认当前时间
    private Date lastLoginTime;    // 最后登录时间，对应users.last_login_time
    private Integer is_admin;// 角色：0普通用户，1管理员（数据库无直接对应字段）
```

### Attachment.java

**作用**：文件实体类
**属性/方法**：

```
private Integer id;         // 附件ID，对应attachments.id，主键自增
private String filename;    // 文件名，对应attachments.filename
private String filePath;    // 文件路径，对应attachments.file_path
private String fileType;    // 文件类型，对应attachments.file_type
private Long fileSize;      // 文件大小（字节），对应attachments.file_size
private Integer userId;     // 上传用户ID，对应attachments.user_id，外键关联users.id
private Integer postId;     // 关联帖子ID，对应attachments.post_id，外键关联posts.id
private Integer commentId;  // 关联评论ID，对应attachments.comment_id，外键关联comments.id
private Date createTime;    // 上传时间，对应attachments.create_time，默认当前时间
```

### BrowseHistory

**作用**：浏览记录实体类
**属性/方法**：

```
private Integer id;         // 浏览记录ID，对应browse_history.id，主键自增
private Integer userId;     // 用户ID，对应browse_history.user_id，外键关联users.id
private Integer postId;     // 帖子ID，对应browse_history.post_id，外键关联posts.id
private Date browseTime;    // 浏览时间，对应browse_history.browse_time，默认当前时间
```

### Captcha（只用于登录的验证码中）

**作用**：验证码对照实体类
**属性/方法**：

```
private String code;
private String see;
```

### Exchange

**作用**：兑换实体类
**属性/方法**：

```
private Integer id;         // 兑换记录ID，对应exchanges.id，主键自增
private Integer userId;     // 用户ID，对应exchanges.user_id，外键关联users.id
private Integer goodsId;    // 道具ID，对应exchanges.goods_id，外键关联virtual_goods.id
private Integer quantity;   // 兑换数量，对应exchanges.quantity，默认1
private Integer totalCost;  // 总花费积分，对应exchanges.total_cost
private Date createTime;    // 兑换时间，对应exchanges.create_time，默认当前时间
```

### LoginLog

**作用**：登录记录实体类
**属性/方法**：

```
private Integer id;         // 登录记录ID，对应login_logs.id，主键自增
private Integer userId;     // 用户ID，对应login_logs.user_id，外键关联users.id
private String ipAddress;   // IP地址，对应login_logs.ip_address
private String userAgent;   // 用户代理，对应login_logs.user_agent
private Date loginTime;     // 登录时间，对应login_logs.login_time，默认当前时间
```

### Notification

**作用**：通知实体类
**属性/方法**：

```
private Integer id;         // 通知ID，对应notifications.id，主键自增
private Integer userId;     // 接收用户ID，对应notifications.user_id，外键关联users.id
private String type;        // 通知类型：reply回复,like点赞,system系统通知，对应notifications.type枚举
private String title;       // 通知标题，对应notifications.title
private String content;     // 通知内容，对应notifications.content
private Integer relatedId;  // 关联ID，对应notifications.related_id，关联帖子/评论ID
private Integer isRead;     // 已读状态：0未读，1已读，对应notifications.is_read，默认false
private Date createTime;    // 创建时间，对应notifications.create_time，默认当前时间
```

### Photo（只用于登录的验证码中）

**作用**：照片实体类
**属性/方法**：

```
private String text;
private int correctAngle;
private String base64Image;
private String originalImage;
private int initialAngle;
```

### PointsRecord

**作用**：积分记录实体类
**属性/方法**：

```
private Integer id;            // 积分记录ID，对应points_records.id，主键自增
private Integer userId;        // 用户ID，对应points_records.user_id，外键关联users.id
private String changeType;     // 变更类型，对应points_records.change_type的枚举值
private Integer changeAmount;  // 变更数量，对应points_records.change_amount，正负表示增减
private String description;    // 变更描述，对应points_records.description
private Date createTime;       // 创建时间，对应points_records.create_time，默认当前时间
```

### Post.java

**作用**：帖子实体类
**属性/方法**：

```
    private Integer id;            // 帖子ID，对应posts.id，主键自增
    private String title;          // 帖子标题，对应posts.title
    private String content;        // 帖子内容，对应posts.content
    private Integer userId;        // 发帖用户ID，对应posts.user_id，外键关联users.id
    private Integer sectionId;     // 所属版块ID，对应posts.section_id，外键关联sections.id
    private Integer viewCount;     // 浏览数，对应posts.view_count，默认0
    private Integer likeCount;     // 点赞数，对应posts.like_count，默认0
    private Integer commentCount;  // 评论数，对应posts.comment_count，默认0
    private Integer status;        // 状态：0正常,1置顶,2精华,3删除，对应posts.is_deleted扩展
    private Date createTime;       // 创建时间，对应posts.create_time，默认当前时间
    private Date updateTime;       // 更新时间，对应posts.update_time，更新时自动更新
```

### Comment.java
**作用**：评论实体类
**属性/方法**：

```
private Integer id;         // 评论ID，对应comments.id，主键自增
private String content;     // 评论内容，对应comments.content
private Integer userId;     // 用户ID，对应comments.user_id，外键关联users.id
private Integer postId;     // 帖子ID，对应comments.post_id，外键关联posts.id
private Integer parentId;   // 父评论ID，对应comments.parent_id，0表示直接评论帖子
private Integer likeCount;  // 点赞数，对应comments.like_count，默认0
private Integer status;     // 状态：0正常，1删除，对应comments.is_deleted扩展
private Date createTime;    // 创建时间，对应comments.create_time，默认当前时间
private Date updateTime;    // 更新时间，对应comments.update_time，更新时自动更新
```

### Like.java
**作用**：点赞实体类
**属性/方法**：

```
private Integer id;         // 点赞记录ID，对应likes.id，主键自增
private Integer userId;     // 用户ID，对应likes.user_id，外键关联users.id
private String targetType;  // 点赞对象类型：post帖子,comment评论，对应likes.target_type枚举
private Integer targetId;   // 目标ID，对应likes.target_id，帖子ID或评论ID
private Date createTime;    // 创建时间，对应likes.create_time，默认当前时间
```

### Favorite.java
**作用**：收藏实体类
**属性/方法**：

```
private Integer id;         // 收藏记录ID，对应favorites.id，主键自增
private Integer userId;     // 用户ID，对应favorites.user_id，外键关联users.id
private Integer postId;     // 帖子ID，对应favorites.post_id，外键关联posts.id
private Date createTime;    // 收藏时间，对应favorites.create_time，默认当前时间
```

### VirtualGood

**作用**：道具实体类
**属性/方法**：

```
private Integer id;           // 道具ID，对应virtual_goods.id，主键自增
private String name;          // 道具名称，对应virtual_goods.name
private String description;   // 道具描述，对应virtual_goods.description
private Integer price;        // 价格，对应virtual_goods.price，所需积分
private Integer stock;        // 库存，对应virtual_goods.stock，-1表示无限库存
private Integer isAvailable;  // 可用状态：0不可用，1可用，对应virtual_goods.is_available
private Date createTime;      // 创建时间，对应virtual_goods.create_time，默认当前时间
```

## 六、util包 - 工具类

### DBUtil.java

**作用**：数据库连接工具类，负责管理数据库连接和资源关闭。
**方法**：
- **getConnection：** 获取数据库连接。
- **close (Connection, Statement)：** 关闭连接和语句。
- **close (Connection, Statement, ResultSet)：** 关闭连接、语句和结果集。
- **beginTransaction：** 开启事务。
- **commitTransaction：** 提交事务。
- **rollbackTransaction：** 回滚事务。
- **executeQuery：** 执行查询SQL并返回结果集。
- **executeUpdate：** 执行更新SQL并返回影响行数。

### StringUtil.java
**作用**：字符串工具类，提供字符串验证、处理和生成功能。
**方法**：
- **isEmpty：** 判断字符串是否为空或null。
- **isNotEmpty：** 判断字符串是否不为空。
- **isEmail：** 验证邮箱格式。
- **isPhone：** 验证手机号格式。
- **isUsername：** 验证用户名格式。
- **trim：** 去除字符串两端空格。
- **limitLength：** 限制字符串长度并用省略号表示超出部分。
- **generateRandomString：** 生成指定长度的随机字符串。
- **checkPasswordStrength：** 检查密码强度并返回等级。

### DateUtil.java
**作用**：日期工具类，提供日期格式化功能。
**方法**：
- **formatCurrentTime：** 获取当前时间的格式化字符串。
- **formatDate：** 格式化日期为字符串。
- **getCurrentDateTime：** 获取当前时间的标准格式（yyyy-MM-dd HH:mm:ss）。
- **getCurrentDate：** 获取当前日期（yyyy-MM-dd格式）。

### FileUtil.java
**作用**：文件处理工具类，负责文件上传、下载、删除等操作。
**方法**：
- **createUploadDirs：** 创建上传目录（如果不存在）。
- **generateUniqueFileName：** 生成唯一的文件名。
- **getFileExtension：** 获取文件扩展名。
- **isValidImageType：** 验证文件类型是否为允许的图片类型。
- **saveFile：** 保存上传的文件。
- **deleteFile：** 删除文件。
- **getFileSizeMB：** 获取文件大小（MB）。
- **copyFile：** 复制文件。
- **readFileToBytes：** 读取文件为字节数组。

### Captcha_Make.java
**作用**：验证码生成工具
**方法**：
- **CaptchaResult：** 根据类型和长度生成验证码。
- **num_pdCode：** 生成数字验证码。
- **English_pdCode：** 生成英文字母验证码。
- **mixed_pdCode：** 生成数字和英文字母混合验证码。
- **China_pdCode：** 生成汉字验证码。
- **Arithmetic_pdCode：** 生成算术验证码。
- **pd_finally：** 验证验证码是否正确。

### Image_Num_make（只用于登录）

- **Image_Num_make：** 图形验证码图片生成工具类。
- **Image_Num：** 生成普通图形验证码图片（Base64格式）。
- **draw_lines：** 绘制干扰线（私有方法）。
- **drawText：** 绘制验证码文本（私有方法）。
- **get_China_Font：** 获取支持中文的字体（私有方法）。
- **drawNoise：** 绘制噪点（私有方法）。

### Image_photo_make（只用于登录）

- **Image_photo_make：** 旋转验证码图片生成工具类。
- **getImageFiles：** 获取所有图片文件。
- **getImageDirectoryPath：** 获取图片目录路径。
- **setServletContext：** 设置ServletContext。
- **Image_photo：** 生成旋转验证码。
- **get_local_Image_Path：** 获取本地图片路径（私有方法）。
- **load_Image：** 加载图片文件（私有方法）。
- **createTestImage：** 创建测试图片（私有方法）。
- **create_Rotate_Image：** 创建旋转图片（私有方法）。
- **image_Base64：** 图片转Base64（私有方法）。
- **pd_angle：** 验证旋转角度（容差输入tolerance）。
- **normal_angle：** 规范化角度到0-359范围（私有方法）。
- **getServletContext：** 获取所有文件。

### **SlideImageMaker（只用于登录）**

- **SlideImageMaker：** 滑动验证码生成工具类。
- **SlideResult：** 滑动验证码结果内部类。
- **setServletContext：** 设置ServletContext。
- **generateSlideCaptcha：** 生成滑动验证码。
- **getLocalImagePath：** 获取本地图片路径（私有方法）。
- **createTestSlideResult：** 创建测试滑动验证码结果（私有方法）。
- **loadImage：** 加载图片（私有方法）。
- **createSlideImages：** 创建滑动验证码图片（私有方法）。
- **scaleImage：** 缩放图片（私有方法）。
- **createBackgroundWithGap：** 创建带缺口的背景图（私有方法）。
- **createPuzzlePiece：** 创建拼图块（私有方法）。
- **imageToBase64：** 图片转Base64（私有方法）。
- **SlideImages：** 内部类用于返回图片数据。
- **validatePosition：** 验证滑动位置。

## 七、filter包 - 过滤器

### CharacterEncodingFilter.java
**作用**：字符编码过滤器，统一设置请求和响应的编码。
**方法**：
- **init：** 初始化过滤器，读取配置的编码参数。
- **doFilter：** 设置请求和响应的编码，然后继续执行过滤器链。
- **destroy：** 销毁过滤器。

### LoginFilter.java
**作用**：登录验证过滤器，检查用户是否已登录。
**方法**：
- **init：** 初始化过滤器，读取排除URL配置。
- **doFilter：** 检查请求URL是否需要登录验证，未登录则跳转到登录页面。
- **isExcludedUrl：** 判断URL是否不需要登录验证。
- **destroy：** 销毁过滤器。

### AdminFilter.java
**作用**：管理员权限过滤器，检查用户是否具有管理员权限。
**方法**：
- **init：** 初始化过滤器。
- **doFilter：** 检查用户Session和权限，未登录则跳转到登录页面。
- **redirectToLogin：** 跳转到登录页面。
- **destroy：** 销毁过滤器。


## 八、listener包 - 监听器

### ContextListener.java
**作用**：应用上下文监听器，在应用启动和关闭时执行初始化/清理工作。
**方法**：
- **contextInitialized：** 应用启动时初始化数据库配置、创建上传目录、设置应用属性。
- **contextDestroyed：** 应用关闭时清理资源，记录运行时间。

### SessionListener.java
**作用**：会话监听器，监控用户会话的创建和销毁。
**方法**：
- **sessionCreated：** 会话创建时增加在线用户计数，记录会话创建时间。
- **sessionDestroyed：** 会话销毁时减少在线用户计数，输出会话持续时间。
- **getActiveSessions：** 静态方法，获取当前在线用户数。

### RequestListener.java
**作用**：请求监听器，记录请求统计、监控异常和执行时间。
**方法**：
- **requestInitialized：** 请求开始时记录开始时间，增加请求计数。
- **requestDestroyed：** 请求结束时统计执行时间，记录异常信息。
- **incrementRequestCount：** 增加请求计数（静态方法）。
- **recordException：** 记录自定义异常并统计。
- **recordError：** 记录HTTP错误状态码并统计。
- **determineStatusCode：** 根据异常类型确定HTTP状态码（私有静态方法）。
- **getRequestStatistics：** 获取请求统计信息（静态方法）。
- **getExceptionReport：** 获取异常统计报告（静态方法）。
- **convertExceptionCountMap：** 转换异常统计Map为可序列化的格式（私有静态方法）。
- **generateRequestId：** 生成请求ID（私有方法）。
- **logRequestStart：** 记录请求开始日志（私有方法）。
- **logRequestEnd：** 记录请求结束日志（私有方法）。
- **RequestContext：** 请求上下文内部类，保存请求相关信息。

## 九、exception包 - 异常类

### BusinessException.java
**作用**：业务异常类，用于业务逻辑错误时抛出。
**方法**：
- **BusinessException(String)：** 通过错误消息构造业务异常。
- **BusinessException(String, String)：** 通过错误码和错误消息构造业务异常。
- **BusinessException(String, String, Object)：** 通过错误码、错误消息和错误详情构造业务异常。
- **BusinessException(String, Throwable)：** 通过错误消息和原因构造业务异常。
- **BusinessException(String, String, Throwable)：** 通过错误码、错误消息和原因构造业务异常。
- **getErrorCode：** 获取错误码。
- **setErrorCode：** 设置错误码。
- **getErrorData：** 获取错误详情。
- **setErrorData：** 设置错误详情。
- **toString：** 重写toString方法，格式化异常信息。

### AuthenticationException.java
**作用**：认证异常类，用户认证失败时抛出。
**方法**：
- **AuthFailureType：** 认证失败类型枚举（USER_NOT_FOUND、INVALID_PASSWORD、ACCOUNT_LOCKED、ACCOUNT_EXPIRED、CREDENTIALS_EXPIRED、TOKEN_INVALID、TOKEN_EXPIRED）。
- **AuthenticationException(String)：** 通过错误消息构造认证异常。
- **AuthenticationException(AuthFailureType, String)：** 通过认证失败类型和错误消息构造认证异常。
- **AuthenticationException(AuthFailureType, String, String)：** 通过认证失败类型、用户名和错误消息构造认证异常。
- **AuthenticationException(String, Throwable)：** 通过错误消息和原因构造认证异常。
- **AuthenticationException(AuthFailureType, String, Throwable)：** 通过认证失败类型、错误消息和原因构造认证异常。
- **getFailureType：** 获取认证失败类型。
- **setFailureType：** 设置认证失败类型。
- **getUsername：** 获取用户名。
- **setUsername：** 设置用户名。
- **toString：** 重写toString方法，格式化异常信息。

### AuthorizationException.java
**作用**：授权异常类，权限不足时抛出。
**方法**：
- **AuthorizationException(String)：** 通过错误消息构造授权异常。
- **AuthorizationException(String, String, String)：** 通过资源、操作和所需权限构造授权异常。
- **AuthorizationException(String, String, String, String)：** 通过资源、操作、所需权限和当前权限构造授权异常。
- **AuthorizationException(String, Throwable)：** 通过错误消息和原因构造授权异常。
- **getResource：** 获取请求的资源。
- **setResource：** 设置请求的资源。
- **getOperation：** 获取请求的操作。
- **setOperation：** 设置请求的操作。
- **getRequiredPermission：** 获取需要的权限。
- **setRequiredPermission：** 设置需要的权限。
- **getCurrentPermission：** 获取用户当前拥有的权限。
- **setCurrentPermission：** 设置用户当前拥有的权限。
- **toString：** 重写toString方法，格式化异常信息。

## 十、测试包 - 测试类

### UserDaoTest.java
**作用**：测试UserDao实现
**方法**：
- **testInsert**：测试插入用户
- **testFindById**：测试根据ID查询用户
- **testFindByUsername**：测试根据用户名查询用户
- **testUpdate**：测试更新用户信息

### PostDaoTest.java
**作用**：测试PostDao实现
**方法**：
- **testInsertPost**：测试插入帖子
- **testFindBySection**：测试查询版块帖子
- **testUpdateViewCount**：测试更新浏览数
- **testDeletePost**：测试删除帖子

### UserServiceTest.java
**作用**：测试UserService业务逻辑
**方法**：
- **testRegister**：测试用户注册
- **testLogin**：测试用户登录
- **testUpdateProfile**：测试更新个人资料
- **testChangePassword**：测试修改密码

### StringUtilTest.java
**作用**：测试字符串工具类
**方法**：
- **testIsEmpty**：测试判空方法
- **testIsEmail**：测试邮箱验证
- **testEscapeHtml**：测试HTML转义
- **testTrim**：测试去除空格